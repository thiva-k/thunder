{
  "name": "Basic + Passkey Authentication and Registration Flow",
  "handle": "default-basic-passkey-flow",
  "flowType": "AUTHENTICATION",
  "nodes": [
    {
      "id": "start",
      "type": "START",
      "onSuccess": "choose_auth_method"
    },
    {
      "id": "choose_auth_method",
      "type": "PROMPT",
      "prompts": [
        {
          "inputs": [
            {
              "ref": "input_username",
              "identifier": "username",
              "type": "TEXT_INPUT",
              "required": true
            },
            {
              "ref": "input_password",
              "identifier": "password",
              "type": "PASSWORD_INPUT",
              "required": true
            }
          ],
          "action": {
            "ref": "action_basic",
            "nextNode": "basic_auth"
          }
        },
        {
          "action": {
            "ref": "action_passkey",
            "nextNode": "prompt_passkey_identifier"
          }
        }
      ]
    },
    {
      "id": "prompt_passkey_identifier",
      "type": "PROMPT",
      "prompts": [
        {
          "inputs": [
            {
              "ref": "passkey_username",
              "identifier": "username",
              "type": "TEXT_INPUT",
              "required": true
            }
          ],
          "action": {
            "ref": "action_continue",
            "nextNode": "identity_resolver"
          }
        }
      ]
    },
    {
      "id": "identity_resolver",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "IdentityResolver"
      },
      "onSuccess": "passkey_challenge",
      "onFailure": "prompt_passkey_identifier"
    },
    {
      "id": "passkey_challenge",
      "type": "TASK_EXECUTION",
      "properties": {
        "relyingPartyId": "localhost",
        "relyingPartyName": "Thunder"
      },
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "challenge"
      },
      "onSuccess": "passkey_verify",
      "onFailure": "prompt_password_for_registration"
    },
    {
      "id": "passkey_verify",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "verify"
      },
      "onSuccess": "auth_assert",
      "onFailure": "choose_auth_method"
    },
    {
      "id": "prompt_password_for_registration",
      "type": "PROMPT",
      "prompts": [
        {
          "inputs": [
            {
              "ref": "reg_password",
              "identifier": "password",
              "type": "PASSWORD_INPUT",
              "required": true
            }
          ],
          "action": {
            "ref": "action_verify_password",
            "nextNode": "basic_auth_for_registration"
          }
        }
      ]
    },
    {
      "id": "basic_auth_for_registration",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "BasicAuthExecutor"
      },
      "onSuccess": "passkey_register_start",
      "onFailure": "prompt_password_for_registration"
    },
    {
      "id": "passkey_register_start",
      "type": "TASK_EXECUTION",
      "properties": {
        "relyingPartyId": "localhost",
        "relyingPartyName": "Thunder"
      },
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "register_start"
      },
      "onSuccess": "passkey_register_finish",
      "onFailure": "choose_auth_method"
    },
    {
      "id": "passkey_register_finish",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "register_finish"
      },
      "onSuccess": "auth_assert",
      "onFailure": "choose_auth_method"
    },
    {
      "id": "basic_auth",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "BasicAuthExecutor"
      },
      "onSuccess": "auth_assert",
      "onFailure": "choose_auth_method"
    },
    {
      "id": "auth_assert",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "AuthAssertExecutor"
      },
      "onSuccess": "end"
    },
    {
      "id": "end",
      "type": "END"
    }
  ]
}
